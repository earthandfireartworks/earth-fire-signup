<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Free Design Pack — Earth & Fire Artworks</title>
  <style>
    :root { --bg:#0b0b12; --card:#12121b; --text:#e9ecf1; --muted:#9aa4b2; --accent:#9b87f5; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background: var(--bg); color: var(--text); margin:0; }
    .wrap { max-width: 680px; margin: 0 auto; padding: 28px 18px 56px; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; padding: 24px; box-shadow: 0 8px 24px rgba(0,0,0,0.35); }
    h1 { font-size: 2rem; margin: 0 0 12px; letter-spacing: .3px; }
    p.lead { color: var(--muted); margin: 0 0 18px; }
    form { display: grid; gap: 12px; margin-top: 14px; }
    input[type="text"], input[type="email"] {
      width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.15);
      background: #0f0f16; color: var(--text); outline: none;
    }
    input::placeholder { color: #778294; }
    label { display: flex; gap: 10px; align-items: flex-start; font-size: 0.95rem; color: #c6cbd5; }
    button {
      padding: 12px 16px; border: 0; border-radius: 12px; background: var(--accent); color: #0c0c12;
      font-weight: 700; cursor: pointer; transition: transform .04s ease, box-shadow .2s;
      box-shadow: 0 8px 16px rgba(155,135,245,.35);
    }
    button:disabled { opacity: .6; cursor: not-allowed; }
    button:active { transform: translateY(1px); }
    .fine { font-size: 0.9rem; color: var(--muted); margin-top: 8px; }
    .hp { display:none; } /* honeypot */
    #msg { min-height: 20px; font-size: .95rem; margin-top: 6px; }
    #msg.ok { color: #4ade80; }
    #msg.err { color: #fb7185; }
    .brand { display:flex; align-items:center; gap:10px; margin-bottom: 8px; }
    .badge { font-size: .78rem; padding: 4px 8px; border-radius: 999px; background: rgba(155,135,245,.15); border: 1px solid rgba(155,135,245,.35); color: #d7d0ff; }
    .footer { text-align:center; margin-top: 22px; color: var(--muted); font-size:.85rem; }
    .download-cta { display:inline-block; margin-top:10px; padding:12px 16px; border-radius:12px; background: #22c55e; color:#0b0b12; font-weight:800; text-decoration:none; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="brand">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M12 2l2.39 4.84L20 7.27l-3.9 3.8L17.3 18 12 15.27 6.7 18l1.2-6.93L4 7.27l5.61-.43L12 2z" stroke="#9b87f5" stroke-width="1.2" fill="none"/>
      </svg>
      <div><div class="badge">Earth &amp; Fire Artworks</div></div>
    </div>

    <div class="card">
      <h1>Get your free design document</h1>
      <p class="lead">Enter your name and email to unlock the download link instantly. No spam — just occasional drops & behind-the-scenes.</p>

      <form id="signup" novalidate>
        <input name="name" type="text" placeholder="Name (required)" autocomplete="name" required />
        <input name="email" type="email" placeholder="Email (required)" autocomplete="email" required />
        <label><input name="consent" type="checkbox" value="true" required /> I agree to receive the file link and occasional updates.</label>
        <div class="hp"><label>Leave this empty: <input name="website" type="text" /></label></div>
        <button id="submitBtn" type="submit" disabled>Unlock the download</button>
        <div id="msg"></div>
      </form>

      <div id="downloadArea" class="hidden"></div>
      <p id="fallbackP" class="fine hidden">If a download button doesn’t appear, <a id="fallbackLink" href="#" target="_blank" rel="noopener">click here</a>.</p>
    </div>

    <div class="footer">© Earth &amp; Fire Artworks</div>
  </div>

  <script>
    // === CONFIG: set your exact file name (case & spaces must match) ===
    const FILE_NAME = 'Free Product Designs.odt';
    // Build a safe relative URL: origin + current directory + encoded filename
    const basePath = (location.pathname.endsWith('/')
      ? location.pathname
      : location.pathname.replace(/[^\/]+$/, ''));
    const FALLBACK_FILE_URL = location.origin + basePath + encodeURIComponent(FILE_NAME);
    document.getElementById('fallbackLink').href = FALLBACK_FILE_URL;

    // Worker endpoint
    const WORKER_SUBSCRIBE_URL = 'https://ef-subscribe.earthandfire123.workers.dev/subscribe';

    const form = document.getElementById('signup');
    const submitBtn = document.getElementById('submitBtn');
    const msg = document.getElementById('msg');
    const dl = document.getElementById('downloadArea');
    const fallbackP = document.getElementById('fallbackP');

    function validate() {
      const nameOk = form.name.value.trim().length > 0;
      const emailOk = form.email.validity.valid && form.email.value.trim().length > 0;
      const consentOk = form.consent.checked;
      submitBtn.disabled = !(nameOk && emailOk && consentOk);
    }
    ['input', 'change'].forEach(evt => form.addEventListener(evt, validate));
    validate();

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (form.website && form.website.value) { return; } // honeypot

      msg.className = '';
      msg.textContent = 'Working…';
      dl.innerHTML = '';
      dl.classList.add('hidden');
      fallbackP.classList.add('hidden');

      const name = form.name.value.trim();
      const email = form.email.value.trim();

      try {
        const res = await fetch(WORKER_SUBSCRIBE_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, consent: true })
        });
        let data = {};
        try { data = await res.json(); } catch {}
        const fileUrl = (data && data.fileUrl) ? data.fileUrl : FALLBACK_FILE_URL;

        if (res.ok && (data.ok === true || !data.error)) {
          msg.className = 'ok';
          msg.textContent = 'Ready!';
          dl.innerHTML = `<a class="download-cta" href="${fileUrl}" target="_blank" rel="noopener">Download now</a>`;
          dl.classList.remove('hidden');
          fallbackP.classList.remove('hidden'); // only visible after success
          form.reset();
          validate();
        } else {
          msg.className = 'err';
          msg.textContent = (data && data.error) ? data.error : 'Something went wrong. Try again later.';
        }
      } catch (err) {
        msg.className = 'err';
        msg.textContent = 'Network error. Please try again.';
      }
    });
  </script>
</body>
</html>
